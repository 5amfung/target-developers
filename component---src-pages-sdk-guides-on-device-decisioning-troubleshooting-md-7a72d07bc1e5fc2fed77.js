(self.webpackChunkdev_site_documentation_template=self.webpackChunkdev_site_documentation_template||[]).push([[548],{27450:function(e,n,t){"use strict";t.r(n),t.d(n,{_frontmatter:function(){return l},default:function(){return s}});var a=t(22122),i=t(19756),o=(t(15007),t(64983)),r=t(99536),d=["components"],l={},m={_frontmatter:l},u=r.Z;function s(e){var n=e.components,t=(0,i.Z)(e,d);return(0,o.mdx)(u,(0,a.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,o.mdx)("h1",{id:"troubleshooting"},"Troubleshooting"),(0,o.mdx)("h2",{id:"validating-configuration"},"Validating Configuration"),(0,o.mdx)("h3",{id:"summary-of-steps"},"Summary of Steps"),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"Ensure the ",(0,o.mdx)("inlineCode",{parentName:"li"},"logger")," is configured"),(0,o.mdx)("li",{parentName:"ol"},"Ensure Target Traces is enabled"),(0,o.mdx)("li",{parentName:"ol"},"Verify the on-device decisioning ",(0,o.mdx)("em",{parentName:"li"},"rule artifact")," has been retrieved and cached according to the polling interval defined."),(0,o.mdx)("li",{parentName:"ol"},"Validate content delivery via the cached rule artifact by creating a test on-device decisioning activity through the form-based experience composer.")),(0,o.mdx)("h2",{id:"ensure-the-logger-is-configured"},"Ensure the logger is configured"),(0,o.mdx)("p",null,"When initializing the SDK, ensure that you enable logging."),(0,o.mdx)("p",null,(0,o.mdx)("strong",{parentName:"p"},"Node.js")),(0,o.mdx)("p",null,"For Node.js SDK a ",(0,o.mdx)("inlineCode",{parentName:"p"},"logger")," object should be provided."),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},'const CONFIG = {\n  client: "<your client code>",\n  organizationId: "<your organization ID>",\n  logger: console\n};\n')),(0,o.mdx)("p",null,(0,o.mdx)("strong",{parentName:"p"},"Java SDK")),(0,o.mdx)("p",null,"For Java SDK ",(0,o.mdx)("inlineCode",{parentName:"p"},"logRequests")," on the ",(0,o.mdx)("inlineCode",{parentName:"p"},"ClientConfig")," should be enabled."),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},'ClientConfig config = ClientConfig.builder()\n  .client("<your client code>")\n  .organizationId("<your organization ID>")\n  .logRequests(true)\n  .build();\n')),(0,o.mdx)("p",null,"Also the JVM should be started with the following command line parameter:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},"$ java -Dorg.slf4j.simpleLogger.defaultLogLevel=DEBUG ...\n")),(0,o.mdx)("h2",{id:"ensure-target-traces-is-enabled"},"Ensure Target Traces is enabled"),(0,o.mdx)("p",null,"Enabling traces will output additional information from Adobe Target in regards to the rules artifact."),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("p",{parentName:"li"},"Navigate to the Target UI in Experience Cloud."),(0,o.mdx)("p",{parentName:"li"},(0,o.mdx)("em",{parentName:"p"},"Insert image-target-ui-1.png")))),(0,o.mdx)("p",null,"1 Navigate to ",(0,o.mdx)("strong",{parentName:"p"},"Administration")," > ",(0,o.mdx)("strong",{parentName:"p"},"Implementation")," and click ",(0,o.mdx)("strong",{parentName:"p"},"Generate New Authorization Token"),"."),(0,o.mdx)("p",null,"   ",(0,o.mdx)("em",{parentName:"p"},"Insert image-target-ui-2.png")),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"Copy the newly generated authorization token to the clipboard and add it to your Target request:")),(0,o.mdx)("p",null,(0,o.mdx)("strong",{parentName:"p"},"Node.js")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},'const request = {\n  trace: {\n    authorizationToken: "88f1a924-6bc5-4836-8560-2f9c86aeb36b"\n  },\n  execute: {\n    mboxes: [{\n      name: "sdk-mbox"\n    }]\n}};\n')),(0,o.mdx)("p",null,(0,o.mdx)("strong",{parentName:"p"},"Java SDK")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},'Trace trace = new Trace()\n  .authorizationToken("88f1a924-6bc5-4836-8560-2f9c86aeb36b");\nContext context = new Context()\n  .channel(ChannelType.WEB);\nMboxRequest mbox = new MboxRequest()\n  .name("sdk-mbox")\n  .index(0);\nExecuteRequest executeRequest = new ExecuteRequest()\n  .mboxes(Arrays.asList(mbox));\n\nTargetDeliveryRequest request = TargetDeliveryRequest.builder()\n  .trace(trace)\n  .context(context)\n  .execute(executeRequest)\n  .build();\n')),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"With the logger and trace in place, start your app and monitor the server terminal. The following output from the logger confirms that the rule artifact has been retrieved:")),(0,o.mdx)("p",null,(0,o.mdx)("strong",{parentName:"p"},"Node.js SDK")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},"  AT: LD.ArtifactProvider fetching artifact - https://assets.adobetarget.com/your-client-code/production/v1/rules.json\n  AT: LD.ArtifactProvider artifact received - status=200\n")),(0,o.mdx)("p",null,(0,o.mdx)("strong",{parentName:"p"},"Java SDK")),(0,o.mdx)("p",null,"TBD"),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("p",{parentName:"li"},"Wait the duration of the polling interval (default is 5 minutes) and ensure that the artifact is being fetched by the SDK. The same terminal logs will be output."),(0,o.mdx)("p",{parentName:"li"},"Additionally, information from the the Target Trace should be outputted to the terminal with details about the rule artifact."))),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},'"trace": {\n   "clientCode": "your-client-code",\n   "artifact": {\n     "artifactLocation": "https://assets.adobetarget.com/your-client-code/production/v1/rules.json",\n     "pollingInterval": 300000,\n     "pollingHalted": false,\n     "artifactVersion": "1.0.0",\n     "artifactRetrievalCount": 10,\n     "artifactLastRetrieved": "2020-09-20T00:09:42.707Z",\n     "clientCode": "your-client-code",\n     "environment": "production",\n     "generatedAt": "2020-09-22T17:17:59.783Z"\n   },\n')),(0,o.mdx)("h2",{id:"validate-content-delivery-via-the-cached-rule-artifact-by-creating-a-test-on-device-decisioning-activity-through-the-form-based-experience-composer"},"Validate content delivery via the cached rule artifact by creating a test on-device decisioning activity through the form-based experience composer."),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("p",{parentName:"li"},"Navigate to the Target UI in Experience Cloud"),(0,o.mdx)("p",{parentName:"li"},(0,o.mdx)("em",{parentName:"p"},"Insert image-target-ui-1.png"))),(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("p",{parentName:"li"},"Create a new XT activity using the Form-based Experience Composer."),(0,o.mdx)("p",{parentName:"li"},(0,o.mdx)("em",{parentName:"p"},"Insert image-form-base-composer-ui.png"))),(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("p",{parentName:"li"},"Input the mbox name used in your Target request as the location for the XT activity (note this should be a unique mbox name specifically for development purposes)."),(0,o.mdx)("p",{parentName:"li"},(0,o.mdx)("em",{parentName:"p"},"Insert image-mbox-location-ui.png"))),(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("p",{parentName:"li"},"Change the content to either an HTML offer or JSON offer. This will be returned in the Target request to your application. Leave targeting for the activity as 'All Visitors' and select any metric you would like. Name the activity, save it, and then activate it to ensure the mbox/location in use is only for development."),(0,o.mdx)("p",{parentName:"li"},(0,o.mdx)("em",{parentName:"p"},"Insert image-target-content-ui.png"))),(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("p",{parentName:"li"},"In your application, add a log statements for the content received in the response from your Target request"))),(0,o.mdx)("p",null,(0,o.mdx)("strong",{parentName:"p"},"Node.js SDK")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},"try {\n  const response = await targetClient.getOffers({ request });\n  console.log('Response: ', response.response.execute.mboxes[0].options[0].content);\n} catch (error) {\n  console.error('Something went wrong', error);\n}\n")),(0,o.mdx)("p",null,(0,o.mdx)("strong",{parentName:"p"},"Java SDK")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},'try {\n  Context context = new Context()\n    .channel(ChannelType.WEB);\n  MboxRequest mbox = new MboxRequest()\n    .name("sdk-mbox")\n    .index(0);\n  ExecuteRequest executeRequest = new ExecuteRequest()\n    .mboxes(Arrays.asList(mbox));\n\n  TargetDeliveryRequest request = TargetDeliveryRequest.builder()\n    .context(context)\n    .decisioningMethod(DecisioningMethod.ON_DEVICE)\n    .execute(executeRequest)\n    .build();\n\n    TargetDeliveryResponse response = targetClient.getOffers(request);\n  logger.debug("Response: ", response.getResponse().getExecute().getMboxes().get(0).getOptions().get(0).getContent());\n} catch (Exception exception) {\n  logger.error("Something went wrong", exception);\n}\n')),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"Review the logs in your terminal to verify that your content is being delivered and that it was delivered via the rules artifact on your server. The ",(0,o.mdx)("inlineCode",{parentName:"li"},"LD.DeciscionProvider")," object is outputted when the activity qualification and decisioning were determined on-device based on the rules artifact. Furthermore, due to the logging of the ",(0,o.mdx)("inlineCode",{parentName:"li"},"content"),", you should see ",(0,o.mdx)("inlineCode",{parentName:"li"},"<div>test</div>")," or however you have decided the response to be when creating the test activity.")),(0,o.mdx)("p",null,(0,o.mdx)("strong",{parentName:"p"},"Logger output")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},"AT: LD.DecisionProvider {...}\nAT: Response received {...}\nResponse:  <div>test</div>\n")),(0,o.mdx)("h2",{id:"common-troubleshooting-scenarios"},"Common Troubleshooting Scenarios"),(0,o.mdx)("p",null,(0,o.mdx)("strong",{parentName:"p"},"NOTE"),": Please be sure to review ",(0,o.mdx)("em",{parentName:"p"},"supported features")," for on-device decisioning when running into issues."),(0,o.mdx)("h3",{id:"on-device-decisioning-activities-not-executing-due-to-unsupported-audience-or-activity"},"On-device decisioning activities not executing due to unsupported audience or activity"),(0,o.mdx)("p",null,"A common issue that can occur is on-device decisioning activities not executing due to the audience in use or the activity type being unsupported."),(0,o.mdx)("p",null,"(1) Using the logger output, review the entries in the trace property in your response object. Specifically identify the campaigns property:"),(0,o.mdx)("p",null,(0,o.mdx)("strong",{parentName:"p"},"Trace output")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},'  "execute": {\n  "mboxes": [\n    {\n      "name": "your-mbox-name",\n      "index": 0,\n      "trace": {\n        "clientCode": "your-client-code",\n        ...\n        "campaigns": [],\n        ...\n      }\n    }\n')),(0,o.mdx)("p",null,"You will notice that the activity you are trying to qualify for is not in the ",(0,o.mdx)("inlineCode",{parentName:"p"},"campaigns")," property since the audience or activity type is not supported. If the activity is listed under the ",(0,o.mdx)("inlineCode",{parentName:"p"},"campaigns")," property, your issue is not due to an unsupported audience or activity type."),(0,o.mdx)("p",null,"(2) Additionally, locate the ",(0,o.mdx)("inlineCode",{parentName:"p"},"rules.json")," file by looking at the ",(0,o.mdx)("inlineCode",{parentName:"p"},"trace")," > ",(0,o.mdx)("inlineCode",{parentName:"p"},"artifact")," > ",(0,o.mdx)("inlineCode",{parentName:"p"},"artifactLocation")," in your logger output and notice that your activity is missing from the ",(0,o.mdx)("inlineCode",{parentName:"p"},"rules")," > ",(0,o.mdx)("inlineCode",{parentName:"p"},"mboxes")," property:"),(0,o.mdx)("p",null,(0,o.mdx)("strong",{parentName:"p"},"Logger output")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"}," ...\n rules: {\n   mboxes: { },\n   views: { }\n }\n")),(0,o.mdx)("p",null,"Finally, navigate to the Target UI and locate the activity in question: ",(0,o.mdx)("a",{parentName:"p",href:"https://experience.adobe.com/target"},"experience.adobe.com/target")),(0,o.mdx)("p",null,"Review the rules used in the audience and ensure you only use those aforementioned that are supported. Additionally, ensure that the activity type is either A/B or XT."),(0,o.mdx)("p",null,(0,o.mdx)("em",{parentName:"p"},"Insert image-target-audience-ui.png")),(0,o.mdx)("h3",{id:"on-device-decisioning-activities-not-executing-due-to-unqualified-audience"},"On-device decisioning activities not executing due to unqualified audience"),(0,o.mdx)("p",null,"If an on-device decisioning activity is not executing, but you have verified that your rules.json file contains the activity, run through the following steps:"),(0,o.mdx)("p",null,"(1) Ensure that the mbox you are executing in your application is the same one the activity is using:"),(0,o.mdx)("p",null,(0,o.mdx)("strong",{parentName:"p"},"rules.json")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"}," ...\n rules: {\n   mboxes: {\n    target-only-node-sdk-mbox: [{ // this mbox name must match the mbox in your request\n      ...\n    }]\n   }\n ...\n")),(0,o.mdx)("p",null," ",(0,o.mdx)("strong",{parentName:"p"},"Node.js SDK")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},"const request = {\n  trace: {\n    authorizationToken: '2dfc1dce-1e58-4e05-bbd6-a6725893d4d6'\n  },\n  execute: {\n    mboxes: [{\n      address: getAddress(req),\n      name: \"target-only-node-sdk-mbox-two\" // this mbox name must match the mbox the activity is using\n    }]\n  }};\n")),(0,o.mdx)("p",null,(0,o.mdx)("strong",{parentName:"p"},"Java SDK")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},'Context context = new Context()\n  .channel(ChannelType.WEB);\nMboxRequest mbox = new MboxRequest()\n  .name("target-only-node-sdk-mbox-two")\n  .index(0);\nExecuteRequest executeRequest = new ExecuteRequest()\n  .mboxes(Arrays.asList(mbox));\n\nTargetDeliveryRequest request = TargetDeliveryRequest.builder()\n  .context(context)\n  .decisioningMethod(DecisioningMethod.ON_DEVICE)\n  .execute(executeRequest)\n  .build();\n\nTargetDeliveryResponse response = targetClient.getOffers(request);\n')),(0,o.mdx)("p",null,"(2) Ensure that you are qualified for the audience for you activity by reviewing the ",(0,o.mdx)("inlineCode",{parentName:"p"},"matchedRuleConditions")," or ",(0,o.mdx)("inlineCode",{parentName:"p"},"unmatchedRuleConditions")," property of your trace output:"),(0,o.mdx)("p",null,(0,o.mdx)("strong",{parentName:"p"},"Trace output")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},'...\n},\n"campaignId": 368564,\n"campaignType": "landing",\n"matchedSegmentIds": [],\n"unmatchedSegmentIds": [\n  6188838\n      ],\n      "matchedRuleConditions": [],\n          "unmatchedRuleConditions": [\n            {\n              "in": [\n                "true",\n                {\n                  "var": "mbox.auth_lc"\n                }\n              ]\n            }\n          ]\n    ...\n')),(0,o.mdx)("p",null,"If you have unmatched rule conditions, you are not qualified for the activity and thus the activity will not execute. Review the rules in your audience to see why you are not qualifying."),(0,o.mdx)("h3",{id:"on-device-decisioning-activity-not-executing-but-reason-not-apparent"},"On-device decisioning activity not executing, but reason not apparent"),(0,o.mdx)("p",null,"It may not be readily apparent why an on-device decisioning activity is not executing. In this case, follow these troubleshooting steps to identify the issue:"),(0,o.mdx)("p",null,"(1) Read through the logger trace output in your console and identify the artifact property, which will look similar to the following:"),(0,o.mdx)("p",null,(0,o.mdx)("strong",{parentName:"p"},"Trace output")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},'...\n      "artifact": {\n          "artifactLocation": "https://assets.adobetarget.com/your-client-code/production/v1/rules.json",\n          "pollingInterval": 300000,\n          "pollingHalted": false,\n          "artifactVersion": "1.0.0",\n          "artifactRetrievalCount": 3,\n          "artifactLastRetrieved": "2020-10-16T00:56:27.596Z",\n          "clientCode": "adobeinterikleisch",\n          "environment": "production"\n        },\n...\n')),(0,o.mdx)("p",null,"Look at the ",(0,o.mdx)("inlineCode",{parentName:"p"},"artifactLastRetrieved")," date of the artifact and ensure that you have the latest ",(0,o.mdx)("inlineCode",{parentName:"p"},"rules.json")," file downloaded to your app."),(0,o.mdx)("p",null,"(2) Find the ",(0,o.mdx)("inlineCode",{parentName:"p"},"evaluatedCampaignTargets")," property in your logger output:"),(0,o.mdx)("p",null,(0,o.mdx)("strong",{parentName:"p"},"Logger output")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},'... \n  "evaluatedCampaignTargets": [\n      {\n        "context": {\n          "current_timestamp": 1602812599608,\n          "current_time": "0143",\n          "current_day": 5,\n          "user": {\n            "browserType": "unknown",\n            "platform": "Unknown",\n            "locale": "en",\n            "browserVersion": -1\n          },\n          "page": {\n            "url": "localhost:3000/",\n            "path": "/",\n            "query": "",\n            "fragment": "",\n            "subdomain": "",\n            "domain": "3000",\n            "topLevelDomain": "",\n            "url_lc": "localhost:3000/",\n            "path_lc": "/",\n            "query_lc": "",\n            "fragment_lc": "",\n            "subdomain_lc": "",\n            "domain_lc": "3000",\n            "topLevelDomain_lc": ""\n          },\n          "referring": {\n            "url": "localhost:3000/",\n            "path": "/",\n            "query": "",\n            "fragment": "",\n            "subdomain": "",\n            "domain": "3000",\n            "topLevelDomain": "",\n            "url_lc": "localhost:3000/",\n            "path_lc": "/",\n            "query_lc": "",\n            "fragment_lc": "",\n            "subdomain_lc": "",\n            "domain_lc": "3000",\n            "topLevelDomain_lc": ""\n          },\n          "geo": {},\n          "mbox": {},\n          "allocation": 23.79\n        },\n        "campaignId": 368564,\n        "campaignType": "landing",\n        "matchedSegmentIds": [],\n        "unmatchedSegmentIds": [\n          6188838\n        ],\n        "matchedRuleConditions": [],\n        "unmatchedRuleConditions": [\n          {\n            "in": [\n              "true",\n              {\n                "var": "mbox.auth_lc"\n              }\n            ]\n          }\n        ]\n...\n')),(0,o.mdx)("p",null,"(3) Review the ",(0,o.mdx)("inlineCode",{parentName:"p"},"context"),", ",(0,o.mdx)("inlineCode",{parentName:"p"},"page"),", and ",(0,o.mdx)("inlineCode",{parentName:"p"},"referring")," data to ensure it is as expected as this can affect the targeting qualification of the activity."),(0,o.mdx)("p",null,"(4) Review the ",(0,o.mdx)("inlineCode",{parentName:"p"},"campaignId")," to ensure the activity or activities you are expecting to execute are evaluated. The ",(0,o.mdx)("inlineCode",{parentName:"p"},"campaignId")," will match the activity ID on the activity overview tab in the Target UI:"),(0,o.mdx)("p",null,(0,o.mdx)("em",{parentName:"p"},"Insert image-activity-id-target-ui.png")),(0,o.mdx)("p",null,"(5) Review the ",(0,o.mdx)("inlineCode",{parentName:"p"},"matchedRuleConditions")," and ",(0,o.mdx)("inlineCode",{parentName:"p"},"unmatchedRuleConditions")," to identify issues with qualifying for the audience rules for a given activity."),(0,o.mdx)("p",null,"(6) Review the latest ",(0,o.mdx)("inlineCode",{parentName:"p"},"rules.json")," file to ensure the activity or activities you want to execute locally are included. The location is referenced above in step 1."),(0,o.mdx)("p",null,"(7) Ensure you are using the same mbox names in your request and activities."),(0,o.mdx)("p",null,"(8) Ensure you are using supported audience rules and supported activity types."))}s.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-sdk-guides-on-device-decisioning-troubleshooting-md-7a72d07bc1e5fc2fed77.js.map