{"version":3,"sources":["webpack://dev-site-documentation-template/./src/pages/sdk-guides/on-device-decisioning/rule-artifact/downloading-storing-updating-json.md"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"mappings":"oTAQaA,EAAe,GACtBC,EAAc,CAClBD,gBAEIE,EAAYC,IACH,SAASC,EAAT,GAGX,IAFFC,EAEC,EAFDA,WACGC,GACF,YACD,OAAO,SAACJ,GAAD,UAAeD,EAAiBK,EAAhC,CAAuCD,WAAYA,EAAYE,QAAQ,eAG5E,eACE,GAAM,uEADR,0EAGA,8WACA,eACE,GAAM,oBADR,qBAGA,oBACE,eAAIC,WAAW,MAAf,oBACA,eAAIA,WAAW,MAAf,uBACA,eAAIA,WAAW,MAAf,oCAEF,eACE,GAAM,mBADR,oBAGA,mBAAG,mBAAQA,WAAW,KAAnB,SACH,qBAAK,iBAAMA,WAAW,OAAjB,yCAEL,mBAAG,mBAAQA,WAAW,KAAnB,SACH,qBAAK,iBAAMA,WAAW,OAAjB,+IAML,eACE,GAAM,sBADR,uBAGA,oBACE,eAAIA,WAAW,MAAf,qGAEF,mBAAG,mBAAQA,WAAW,KAAnB,aACH,qBAAK,iBAAMA,WAAW,OAAjB,iEAEL,mBAAG,mBAAQA,WAAW,KAAnB,UACH,qBAAK,iBAAMA,WAAW,OAAjB,4GAGL,oBACE,eAAIA,WAAW,MAAf,kDAEF,mBAAG,mBAAQA,WAAW,KAAnB,aACH,qBAAK,iBAAMA,WAAW,OAAjB,86BAyBL,mBAAG,mBAAQA,WAAW,KAAnB,UACH,qBAAK,iBAAMA,WAAW,OAAjB,mnBAmBL,oBACE,eAAIA,WAAW,MAAf,oBAAwC,uBAAYA,WAAW,MAAvB,kBAAxC,yDAA4J,mBAAQA,WAAW,MAAnB,kBAA5J,OAAsN,mBAAQA,WAAW,MAAnB,kBAAtN,sBAEF,mBAAG,eAAIA,WAAW,KAAf,kCACH,eACE,GAAM,kCADR,mCAGA,uUACA,mBAAG,mBAAQA,WAAW,KAAnB,aACH,qBAAK,iBAAMA,WAAW,OAAjB,+nBAmBL,mBAAG,mBAAQA,WAAW,KAAnB,UACH,qBAAK,iBAAMA,WAAW,OAAjB,iVAOL,mBAAG,mBAAQA,WAAW,KAAnB,QAAH,qPACA,iGACA,mBAAG,mBAAQA,WAAW,KAAnB,aACH,qBAAK,iBAAMA,WAAW,OAAjB,s9EAmFL,mBAAG,mBAAQA,WAAW,KAAnB,UACH,qBAAK,iBAAMA,WAAW,OAAjB,8tDAmDTJ,EAAWK,gBAAiB","file":"component---src-pages-sdk-guides-on-device-decisioning-rule-artifact-downloading-storing-updating-json-md-46101382bf2331d9b406.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/target-developers/target-developers/node_modules/@adobe/gatsby-theme-aio/src/components/MDXFilter/index.js\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"downloading-storing-and-updating-the-rule-artifact-via-json-payload\"\n    }}>{`Downloading, Storing, and Updating the Rule Artifact via JSON Payload`}</h1>\n    <p>{`This approach is best if your application is structured in a way that requires the SDK to be initialized on each file in which it uses SDK methods. Before your web application can use the JSON payload of the rule artifact during SDK initialization, you should ensure the JSON payload is downloaded and is available for your application to use.`}</p>\n    <h3 {...{\n      \"id\": \"summary-of-steps\"\n    }}>{`Summary of steps`}</h3>\n    <ol>\n      <li parentName=\"ol\">{`Install the SDK`}</li>\n      <li parentName=\"ol\">{`Initialize the SDK`}</li>\n      <li parentName=\"ol\">{`Store and Use the JSON Payload`}</li>\n    </ol>\n    <h2 {...{\n      \"id\": \"install-the-sdk\"\n    }}>{`Install the SDK`}</h2>\n    <p><strong parentName=\"p\">{`NPN`}</strong></p>\n    <pre><code parentName=\"pre\" {...{}}>{`npm i @adobe/target-nodejs-sdk -P\n`}</code></pre>\n    <p><strong parentName=\"p\">{`MVN`}</strong></p>\n    <pre><code parentName=\"pre\" {...{}}>{`<dependency>\n    <groupId>com.adobe.target</groupId>\n    <artifactId>java-sdk</artifactId>\n    <version>1.0</version>\n</dependency>\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"initialize-the-sdk\"\n    }}>{`Initialize the SDK`}</h2>\n    <ol>\n      <li parentName=\"ol\">{`First, import the SDK. Import to the same file from which you can control your server start-up.`}</li>\n    </ol>\n    <p><strong parentName=\"p\">{`Node.js`}</strong></p>\n    <pre><code parentName=\"pre\" {...{}}>{`const TargetClient = require(\"@adobe/target-nodejs-sdk\");\n`}</code></pre>\n    <p><strong parentName=\"p\">{`Java`}</strong></p>\n    <pre><code parentName=\"pre\" {...{}}>{`import com.adobe.target.edge.client.ClientConfig;\nimport com.adobe.target.edge.client.TargetClient;\n`}</code></pre>\n    <ol>\n      <li parentName=\"ol\">{`To configure the SDK, use the create method.`}</li>\n    </ol>\n    <p><strong parentName=\"p\">{`Node.js`}</strong></p>\n    <pre><code parentName=\"pre\" {...{}}>{`const CONFIG = {\n    client: \"<your target client code>\",\n    organizationId: \"your EC org id\",\n    decisioningMethod: \"on-device\",\n    pollingInterval : 300000,\n    events: {\n        artifactDownloadSucceeded: onArtifactDownloadSucceeded,\n        artifactDownloadFailed: onArtifactDownloadFailed\n    }\n};\n\nconst TargetClient = TargetClient.create(CONFIG);\n\nfunction onArtifactDownloadSucceeded(event) {\n    //Adobe Target SDK has now downloaded the JSON Artifact/Payload\n    console.log(event.artifactLocation) // Location from where the Artifact is downloaded.\n    console.log(event.artifactPayload) // JSON Payload which we can store locally.\n}\n\nfunction onArtifactDownloadFailed(event) {\n    //Adobe Target SDK has failed to download the JSON Artifact/Payload.\n    console.log(event.artifactLocation) // Location from where the Artifact is downloaded.\n    console.log(event.error.message) // Error message\n}\n`}</code></pre>\n    <p><strong parentName=\"p\">{`Java`}</strong></p>\n    <pre><code parentName=\"pre\" {...{}}>{`package com.adobe.target.edge.client.model.ondevice.OnDeviceDecisioningHandler;\n\nClientConfig config = ClientConfig.builder()\n    .client(\"<you target client code>\")\n    .organizationId(\"<your EC org id>\")\n    .onDeviceDecisioningHandler(\n      new OnDeviceDecisioningHandler() {\n        void onDeviceDecisioningReady() {\n          // On-Device Decision is ready.\n        }\n        void artifactDownloadSucceeded(byte[] artifactData) {\n          // Store artifactData to local disk.        \n          // ...\n        }\n      }\n    )\n    .build();\nTargetClient targetClient = TargetClient.create(config);\n`}</code></pre>\n    <ol>\n      <li parentName=\"ol\">{`Both client and `}<inlineCode parentName=\"li\">{`organizationId`}</inlineCode>{` can be retrieved from Adobe Target by navigating to `}<strong parentName=\"li\">{`Administration`}</strong>{` > `}<strong parentName=\"li\">{`Implementation`}</strong>{`, as shown here.`}</li>\n    </ol>\n    <p><em parentName=\"p\">{`Insert image-client-code.png`}</em></p>\n    <h2 {...{\n      \"id\": \"store-and-use-the-json-payload\"\n    }}>{`Store and Use the JSON Payload`}</h2>\n    <p>{`The mechanism you use to store the JSON payload depends on your system architecture. You can use a local file, a database, or a memory object caching system such as Memcached . You need to be able to read this JSON from your application for consumption. In this guide, we use a local file as the storage.`}</p>\n    <p><strong parentName=\"p\">{`Node.js`}</strong></p>\n    <pre><code parentName=\"pre\" {...{}}>{`//... Code removed for brevity\n\nfunction onArtifactDownloadSucceeded(event) {\n    const jsonPath = 'src/config/target-rules.json'\n    fs.writeFile(jsonPath, JSON.stringify(event.artifactPayload), 'utf8', (err) => {\n        if (err) {\n            throw err;\n        };\n        console.log(\\`The artifact from '\\${event.artifactLocation}' is now saved to '\\${jsonPath}'\\`);\n    });\n}\n\n\nfunction onArtifactDownloadFailed(event) {\n  console.log(\\`The local decisioning artifact failed to download from '\\${event.artifactLocation}' with the following error message: \\${event.error.message}\\`);\n}\n\n//... Code removed for brevity\n`}</code></pre>\n    <p><strong parentName=\"p\">{`Java`}</strong></p>\n    <pre><code parentName=\"pre\" {...{}}>{`MboxRequest mbox = new MboxRequest().name(\"homepage\").index(0);\nTargetDeliveryRequest request = TargetDeliveryRequest.builder()\n    .context(new Context().channel(ChannelType.WEB))\n    .execute(new ExecuteRequest().mboxes(Arrays.asList(mbox)))\n    .build();\nTargetDeliveryResponse response = targetClient.getOffers(request);\n`}</code></pre>\n    <p><strong parentName=\"p\">{`NOTE`}</strong>{`:: By initializing the Adobe Target SDK via the JSON payload, your server is ready to serve requests immediately with on-device decisioning activities, since the Adobe Target SDK does not need to wait for the rule artifact to be downloaded.`}</p>\n    <p>{`Here is an example demonstrating the JSON payload-initializing capability.`}</p>\n    <p><strong parentName=\"p\">{`Node.js`}</strong></p>\n    <pre><code parentName=\"pre\" {...{}}>{`const express = require(\"express\");\nconst cookieParser = require(\"cookie-parser\");\nconst TargetClient = require(\"@adobe/target-nodejs-sdk\");\nconst CONFIG = {\n    client: \"<your target client code>\",\n    organizationId: \"your EC org id\",\n    decisioningMethod: \"on-device\",\n    pollingInterval : 300000,\n    events: {\n        clientReady : startWebServer,\n        artifactDownloadSucceeded : onArtifactDownloadSucceeded,\n        artifactDownloadFailed : onArtifactDownloadFailed\n    },\n};\n\nfunction onArtifactDownloadSucceeded(event) {\n    const jsonPath = 'src/config/target-rules.json'\n    fs.writeFile(jsonPath, JSON.stringify(event.artifactPayload), 'utf8', (err) => {\n        if (err) {\n            throw err;\n        };\n        console.log(\\`The artifact from '\\${event.artifactLocation}' is now saved to '\\${jsonPath}'\\`);\n    });\n}\n\nfunction onArtifactDownloadFailed(event) {\n  console.log(\\`The on-device decisioning artifact failed to download from '\\${event.artifactLocation}' with the following error message: \\${event.error.message}\\`);\n}\n\nconst app = express();\nconst targetClient = TargetClient.create(CONFIG);\n\napp.use(cookieParser());\n\nfunction saveCookie(res, cookie) {\n  if (!cookie) {\n    return;\n  }\n\n  res.cookie(cookie.name, cookie.value, {maxAge: cookie.maxAge * 1000});\n}\n\nconst getResponseHeaders = () => ({\n  \"Content-Type\": \"text/html\",\n  \"Expires\": new Date().toUTCString()\n});\n\nfunction sendSuccessResponse(res, response) {\n  res.set(getResponseHeaders());\n  saveCookie(res, response.targetCookie);\n  res.status(200).send(response);\n}\n\nfunction sendErrorResponse(res, error) {\n  res.set(getResponseHeaders());\n  res.status(500).send(error);\n}\n\nfunction startWebServer() {\n    app.get('/*', async (req, res) => {\n    const targetCookie = req.cookies[TargetClient.TargetCookieName];\n    const request = {\n        execute: {\n        mboxes: [{\n            address: { url: req.headers.host + req.originalUrl },\n            name: \"on-device-homepage-banner\" // Ensure that you have a LIVE Activity running on this location\n        }]\n        }};\n\n    try {\n        const response = await targetClient.getOffers({ request, targetCookie });\n        sendSuccessResponse(res, response);\n    } catch (error) {\n        console.error(\"Target:\", error);\n        sendErrorResponse(res, error);\n    }\n    });\n\n    app.listen(3000, function () {\n    console.log(\"Listening on port 3000 and watching!\");\n    });\n}\n`}</code></pre>\n    <p><strong parentName=\"p\">{`Java`}</strong></p>\n    <pre><code parentName=\"pre\" {...{}}>{`import com.adobe.target.edge.client.ClientConfig;\nimport com.adobe.target.edge.client.TargetClient;\nimport com.adobe.target.delivery.v1.model.ChannelType;\nimport com.adobe.target.delivery.v1.model.Context;\nimport com.adobe.target.delivery.v1.model.ExecuteRequest;\nimport com.adobe.target.delivery.v1.model.MboxRequest;\nimport com.adobe.target.edge.client.entities.TargetDeliveryRequest;\nimport com.adobe.target.edge.client.model.TargetDeliveryResponse;\n\n@Controller\npublic class TargetController {\n\n  private TargetClient targetClient;\n\n  TargetController() {\n    // You should instantiate TargetClient in a Bean and inject the instance into this class \n    // but we show the code here for demonstration purpose.\n    ClientConfig config = ClientConfig.builder()\n        .client(\"<you target client code>\")\n        .organizationId(\"<your EC org id>\")\n        .onDeviceDecisioningHandler(\n          new OnDeviceDecisioningHandler() {\n            void onDeviceDecisioningReady() {\n              // On-Device Decision is ready.\n            }\n            void artifactDownloadSucceeded(byte[] artifactData) {\n              // Store artifactData to local disk.        \n              // ...\n            }\n          }\n        )\n        .build();\n    targetClient = TargetClient.create(config);\n  }\n\n  @GetMapping(\"/\")\n  public String homePage() {\n    MboxRequest mbox = new MboxRequest().name(\"homepage\").index(0);\n    TargetDeliveryRequest request = TargetDeliveryRequest.builder()\n        .context(new Context().channel(ChannelType.WEB))\n        .execute(new ExecuteRequest().mboxes(Arrays.asList(mbox)))\n        .build();\n    TargetDeliveryResponse response = targetClient.getOffers(request);\n    // ...\n  }\n}\n`}</code></pre>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}