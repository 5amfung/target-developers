{"version":3,"sources":["webpack://dev-site-documentation-template/./src/pages/sdk-guides/on-device-decisioning/rule-artifact-sdk.md"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"mappings":"oTAQaA,EAAe,GACtBC,EAAc,CAClBD,gBAEIE,EAAYC,IACH,SAASC,EAAT,GAGX,IAFFC,EAEC,EAFDA,WACGC,GACF,YACD,OAAO,SAACJ,GAAD,UAAeD,EAAiBK,EAAhC,CAAuCD,WAAYA,EAAYE,QAAQ,eAG5E,eACE,GAAM,6FADR,gGAGA,8dAA+c,uBAAYC,WAAW,KAAvB,mBAA/c,qDACA,eACE,GAAM,oBADR,qBAGA,oBACE,eAAIA,WAAW,MAAf,oBACA,eAAIA,WAAW,MAAf,uBACA,eAAIA,WAAW,MAAf,qCAEF,eACE,GAAM,mBADR,oBAGA,mBAAG,mBAAQA,WAAW,KAAnB,SACH,qBAAK,iBAAMA,WAAW,OAAjB,yCAEL,mBAAG,mBAAQA,WAAW,KAAnB,SACH,qBAAK,iBAAMA,WAAW,OAAjB,+IAML,eACE,GAAM,sBADR,uBAGA,oBACE,eAAIA,WAAW,MAAf,qGAEF,mBAAG,mBAAQA,WAAW,KAAnB,aACH,qBAAK,iBAAMA,WAAW,OAAjB,iEAEL,mBAAG,mBAAQA,WAAW,KAAnB,UACH,qBAAK,iBAAMA,WAAW,OAAjB,4GAGL,oBACE,eAAIA,WAAW,MAAf,kDAEF,mBAAG,mBAAQA,WAAW,KAAnB,aACH,qBAAK,iBAAMA,WAAW,OAAjB,ieAiBL,mBAAG,mBAAQA,WAAW,KAAnB,UACH,qBAAK,iBAAMA,WAAW,OAAjB,+MAML,oBACE,eAAIA,WAAW,OACb,cAAGA,WAAW,MAAd,uFAA0G,mBAAQA,WAAW,KAAnB,kBAA1G,OAAmK,mBAAQA,WAAW,KAAnB,kBAAnK,qBACA,cAAGA,WAAW,OAAK,eAAIA,WAAW,KAAf,oCAGvB,eACE,GAAM,mCADR,oCAGA,kIACA,mBAAG,mBAAQA,WAAW,KAAnB,aACH,qBAAK,iBAAMA,WAAW,OAAjB,opBAwBL,mBAAG,mBAAQA,WAAW,KAAnB,UACH,qBAAK,iBAAMA,WAAW,OAAjB,iVAOL,mBAAG,mBAAQA,WAAW,KAAnB,QAAH,oCAA+E,uBAAYA,WAAW,KAAvB,gBAA/E,mjBAA0rB,eAAIA,WAAW,KAAf,WAA1rB,MACA,gHACA,mBAAG,mBAAQA,WAAW,KAAnB,aACH,qBAAK,iBAAMA,WAAW,OAAjB,mxDAmEL,mBAAG,mBAAQA,WAAW,KAAnB,UACH,qBAAK,iBAAMA,WAAW,OAAjB,i2CAwCTJ,EAAWK,gBAAiB","file":"component---src-pages-sdk-guides-on-device-decisioning-rule-artifact-sdk-md-57f07a8a6f67acdcb4e1.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/target-developers/target-developers/node_modules/@adobe/gatsby-theme-aio/src/components/MDXFilter/index.js\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"downloading-storing-and-updating-the-rule-artifact-automatically-via-the-adobe-target-sdk\"\n    }}>{`Downloading, Storing, and Updating the Rule Artifact Automatically via the Adobe Target SDK`}</h1>\n    <p>{`This approach is best when you are able to initialize the Adobe Target SDK at the same time you initialize and start your web server. The rule artifact will be downloaded by the Adobe Target SDK and cached into memory before your web server application starts serving requests. Once your web application is up and running, all Adobe Target decisions will be executed using the in-memory rule artifact. The cached rule artifact will be updated based on the `}<inlineCode parentName=\"p\">{`pollingInterval`}</inlineCode>{` you specify during the SDK initialization step.`}</p>\n    <h2 {...{\n      \"id\": \"summary-of-steps\"\n    }}>{`Summary of steps`}</h2>\n    <ol>\n      <li parentName=\"ol\">{`Install the SDK`}</li>\n      <li parentName=\"ol\">{`Initialize the SDK`}</li>\n      <li parentName=\"ol\">{`Store and Use the Rule Artifact`}</li>\n    </ol>\n    <h2 {...{\n      \"id\": \"install-the-sdk\"\n    }}>{`Install the SDK`}</h2>\n    <p><strong parentName=\"p\">{`NPM`}</strong></p>\n    <pre><code parentName=\"pre\" {...{}}>{`npm i @adobe/target-nodejs-sdk -P\n`}</code></pre>\n    <p><strong parentName=\"p\">{`MVN`}</strong></p>\n    <pre><code parentName=\"pre\" {...{}}>{`<dependency>\n    <groupId>com.adobe.target</groupId>\n    <artifactId>java-sdk</artifactId>\n    <version>1.0</version>\n</dependency>\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"initialize-the-sdk\"\n    }}>{`Initialize the SDK`}</h2>\n    <ol>\n      <li parentName=\"ol\">{`First, import the SDK. Import to the same file from which you can control your server start-up.`}</li>\n    </ol>\n    <p><strong parentName=\"p\">{`Node.js`}</strong></p>\n    <pre><code parentName=\"pre\" {...{}}>{`const TargetClient = require(\"@adobe/target-nodejs-sdk\");\n`}</code></pre>\n    <p><strong parentName=\"p\">{`Java`}</strong></p>\n    <pre><code parentName=\"pre\" {...{}}>{`import com.adobe.target.edge.client.ClientConfig;\nimport com.adobe.target.edge.client.TargetClient;\n`}</code></pre>\n    <ol>\n      <li parentName=\"ol\">{`To configure the SDK, use the create method.`}</li>\n    </ol>\n    <p><strong parentName=\"p\">{`Node.js`}</strong></p>\n    <pre><code parentName=\"pre\" {...{}}>{`const CONFIG = {\n    client: \"<your target client code>\",\n    organizationId: \"your EC org id\",\n    decisioningMethod: \"on-device\",\n    pollingInterval : 300000,\n    events: {\n        clientReady: startWebServer\n    }\n};\n\nconst TargetClient = TargetClient.create(CONFIG);\n\nfunction startWebServer() {\n    //Adobe Target SDK has now downloaded the JSON Artifacts and is available in the memory.\n    //You can start your web server now to serve requests now.\n}\n`}</code></pre>\n    <p><strong parentName=\"p\">{`Java`}</strong></p>\n    <pre><code parentName=\"pre\" {...{}}>{`ClientConfig config = ClientConfig.builder()\n    .client(\"<you target client code>\")\n    .organizationId(\"<your EC org id>\")\n    .build();\nTargetClient targetClient = TargetClient.create(config);\n`}</code></pre>\n    <ol>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Both client and organizationId can be retrieved from Adobe Target by navigating to `}<strong parentName=\"p\">{`Administration`}</strong>{` > `}<strong parentName=\"p\">{`Implementation`}</strong>{`, as shown here.`}</p>\n        <p parentName=\"li\"><em parentName=\"p\">{`Insert image-client_code.png`}</em></p>\n      </li>\n    </ol>\n    <h2 {...{\n      \"id\": \"store-and-use-the-rule-artifact\"\n    }}>{`Store and Use the Rule Artifact`}</h2>\n    <p>{`You do not need to manage the rule artifact yourself and calling the SDK methods should be straightforward.`}</p>\n    <p><strong parentName=\"p\">{`Node.js`}</strong></p>\n    <pre><code parentName=\"pre\" {...{}}>{`//req is the request object from the server request listener method\nconst targetCookie = req.cookies[TargetClient.TargetCookieName];\nconst request = {\n    context: {\n        channel: \"web\"\n    },\n    execute: {\n        mboxes: [{\n            address: { url: req.headers.host + req.originalUrl },\n            name: \"on-device-homepage-banner\"\n        }],\n    },\n};\n\nTargetClient.getOffers({\n    request,\n    targetCookie\n}).then(function(response) {\n    //This Target response is coming from the In-memory Target artifact.\n    console.log(\"Target response\", response);\n}).catch(function(err) {\n    console.error(\"Target:\", err);\n})\n`}</code></pre>\n    <p><strong parentName=\"p\">{`Java`}</strong></p>\n    <pre><code parentName=\"pre\" {...{}}>{`MboxRequest mbox = new MboxRequest().name(\"homepage\").index(0);\nTargetDeliveryRequest request = TargetDeliveryRequest.builder()\n    .context(new Context().channel(ChannelType.WEB))\n    .execute(new ExecuteRequest().mboxes(Arrays.asList(mbox)))\n    .build();\nTargetDeliveryResponse response = targetClient.getOffers(request);\n`}</code></pre>\n    <p><strong parentName=\"p\">{`NOTE`}</strong>{`: In the code sample above, the `}<inlineCode parentName=\"p\">{`TargetClient`}</inlineCode>{` object holds a reference to the in-memory rule artifact. When you use this object for invoking standard SDK methods, it uses the in-memory rule artifact for decisioning. If your application is structured such that you need to call the SDK methods in files other than the one that initializes and listens to client requests, and if those files do not have access to the TargetClient object, then you can download the JSON payload and store it in a local JSON file to be consumed on other files, which need to initialize the SDK. This is explained in the next `}<em parentName=\"p\">{`section`}</em>{`.`}</p>\n    <p>{`Here is an example that starts a web application after initializing the Adobe Target SDK.`}</p>\n    <p><strong parentName=\"p\">{`Node.js`}</strong></p>\n    <pre><code parentName=\"pre\" {...{}}>{`const express = require(\"express\");\nconst cookieParser = require(\"cookie-parser\");\nconst TargetClient = require(\"@adobe/target-nodejs-sdk\");\nconst CONFIG = {\n    client: \"<your target client code>\",\n    organizationId: \"your EC org id\",\n    decisioningMethod: \"on-device\",\n    pollingInterval : 300000,\n    events: {\n        clientReady: startWebServer\n    }\n};\n\nconst app = express();\nconst targetClient = TargetClient.create(CONFIG);\n\napp.use(cookieParser());\n\nfunction saveCookie(res, cookie) {\n  if (!cookie) {\n    return;\n  }\n\n  res.cookie(cookie.name, cookie.value, {maxAge: cookie.maxAge * 1000});\n}\n\nconst getResponseHeaders = () => ({\n  \"Content-Type\": \"text/html\",\n  \"Expires\": new Date().toUTCString()\n});\n\nfunction sendSuccessResponse(res, response) {\n  res.set(getResponseHeaders());\n  saveCookie(res, response.targetCookie);\n  res.status(200).send(response);\n}\n\nfunction sendErrorResponse(res, error) {\n  res.set(getResponseHeaders());\n  res.status(500).send(error);\n}\n\nfunction startWebServer() {\n    app.get('/*', async (req, res) => {\n    const targetCookie = req.cookies[TargetClient.TargetCookieName];\n    const request = {\n        execute: {\n        mboxes: [{\n            address: { url: req.headers.host + req.originalUrl },\n            name: \"on-device-homepage-banner\" // Ensure that you have a LIVE Activity running on this location\n        }]\n        }};\n\n    try {\n        const response = await targetClient.getOffers({ request, targetCookie });\n        sendSuccessResponse(res, response);\n    } catch (error) {\n        console.error(\"Target:\", error);\n        sendErrorResponse(res, error);\n    }\n    });\n\n    app.listen(3000, function () {\n    console.log(\"Listening on port 3000 and watching!\");\n    });\n}\n`}</code></pre>\n    <p><strong parentName=\"p\">{`Java`}</strong></p>\n    <pre><code parentName=\"pre\" {...{}}>{`import com.adobe.target.edge.client.ClientConfig;\nimport com.adobe.target.edge.client.TargetClient;\nimport com.adobe.target.delivery.v1.model.ChannelType;\nimport com.adobe.target.delivery.v1.model.Context;\nimport com.adobe.target.delivery.v1.model.ExecuteRequest;\nimport com.adobe.target.delivery.v1.model.MboxRequest;\nimport com.adobe.target.edge.client.entities.TargetDeliveryRequest;\nimport com.adobe.target.edge.client.model.TargetDeliveryResponse;\n\n@Controller\npublic class TargetController {\n\n  private TargetClient targetClient;\n\n  TargetController() {\n    // You should instantiate TargetClient in a Bean and inject the instance into this class \n    // but we show the code here for demonstration purpose.\n    ClientConfig config = ClientConfig.builder()\n        .client(\"<you target client code>\")\n        .organizationId(\"<your EC org id>\")\n        .build();\n    targetClient = TargetClient.create(config);\n  }\n\n  @GetMapping(\"/\")\n  public String homePage() {\n    MboxRequest mbox = new MboxRequest().name(\"homepage\").index(0);\n    TargetDeliveryRequest request = TargetDeliveryRequest.builder()\n        .context(new Context().channel(ChannelType.WEB))\n        .execute(new ExecuteRequest().mboxes(Arrays.asList(mbox)))\n        .build();\n    TargetDeliveryResponse response = targetClient.getOffers(request);\n    // ...\n  }\n}\n`}</code></pre>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}